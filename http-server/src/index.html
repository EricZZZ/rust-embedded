<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ESP32 LED 控制器</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Arial", sans-serif;
        background-color: #f5f5f5;
        color: #333;
        line-height: 1.6;
        padding: 20px;
        max-width: 500px;
        margin: 0 auto;
      }

      .container {
        background-color: #fff;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        padding: 25px;
        text-align: center;
      }

      h1 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 24px;
      }

      .status-container {
        margin: 25px 0;
      }

      .led-indicator {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin: 0 auto;
        border: 3px solid #ddd;
        transition: all 0.3s ease;
      }

      .led-on {
        background-color: #ff4444;
        box-shadow: 0 0 20px #ff4444, inset 0 0 20px #ff6b6b;
        border-color: #ff8b8b;
      }

      .led-off {
        background-color: #ccc;
        box-shadow: inset 0 10px 15px rgba(0, 0, 0, 0.2);
      }

      .status-text {
        font-size: 20px;
        font-weight: bold;
        margin-top: 15px;
        color: #555;
      }

      .controls {
        margin: 25px 0;
      }

      .btn {
        padding: 12px 30px;
        font-size: 18px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
        outline: none;
        margin: 0 10px;
      }

      .btn-on {
        background-color: #2ecc71;
        color: white;
      }

      .btn-off {
        background-color: #e74c3c;
        color: white;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .btn:active {
        transform: translateY(0);
      }

      .connection-status {
        margin-top: 20px;
        font-size: 14px;
        color: #7f8c8d;
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 15px;
        }

        .btn {
          padding: 10px 20px;
          font-size: 16px;
          display: block;
          width: 100%;
          margin: 10px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ESP32 LED 控制器</h1>

      <div class="status-container">
        <div class="led-indicator led-off" id="ledIndicator"></div>
        <div class="status-text" id="statusText">LED状态: 关闭</div>
      </div>

      <div class="controls">
        <button class="btn btn-on" id="btnOn">开启 LED</button>
        <button class="btn btn-off" id="btnOff">关闭 LED</button>
      </div>

      <div class="connection-status" id="connectionStatus">
        正在连接到ESP32...
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const ledIndicator = document.getElementById("ledIndicator");
        const statusText = document.getElementById("statusText");
        const btnOn = document.getElementById("btnOn");
        const btnOff = document.getElementById("btnOff");
        const connectionStatus = document.getElementById("connectionStatus");

        // 初始状态
        let ledState = false;

        // 从ESP32获取初始LED状态
        fetchLEDState();

        // 设置定时器，每5秒更新一次LED状态
        setInterval(fetchLEDState, 5000);

        // 开启LED按钮事件
        btnOn.addEventListener("click", function () {
          controlLED(true);
        });

        // 关闭LED按钮事件
        btnOff.addEventListener("click", function () {
          controlLED(false);
        });

        // 获取LED状态的函数
        function fetchLEDState() {
          fetch("/led/status")
            .then((response) => response.json())
            .then((data) => {
              updateLEDDisplay(data.state);
              connectionStatus.textContent = "已连接到ESP32";
              connectionStatus.style.color = "#2ecc71";
            })
            .catch((error) => {
              console.error("获取LED状态失败:", error);
              connectionStatus.textContent = "ESP32连接失败";
              connectionStatus.style.color = "#e74c3c";
            });
        }

        // 控制LED的函数
        function controlLED(state) {
          const endpoint = state ? "/led/on" : "/led/off";

          fetch(endpoint, { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                updateLEDDisplay(state);
              } else {
                console.error("控制LED失败");
              }
            })
            .catch((error) => {
              console.error("控制请求失败:", error);
              connectionStatus.textContent = "控制命令发送失败";
              connectionStatus.style.color = "#e74c3c";
            });
        }

        // 更新LED显示状态的函数
        function updateLEDDisplay(state) {
          ledState = state;

          if (state) {
            ledIndicator.classList.remove("led-off");
            ledIndicator.classList.add("led-on");
            statusText.textContent = "LED状态: 开启";
            statusText.style.color = "#27ae60";
          } else {
            ledIndicator.classList.remove("led-on");
            ledIndicator.classList.add("led-off");
            statusText.textContent = "LED状态: 关闭";
            statusText.style.color = "#555";
          }
        }
      });
    </script>
  </body>
</html>
